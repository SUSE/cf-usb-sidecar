FROM golang:1.8.4

ENV GOPATH /go
ENV GOBIN /go/bin
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update
RUN apt-get install -y \
    git \
    bash \
    make \
    gcc \
    mercurial \
    build-essential \
    unzip

RUN mkdir /out
RUN wget -O cf.tgz 'https://cli.run.pivotal.io/stable?release=linux64-binary'
RUN tar xzf cf.tgz -C /out cf
RUN wget -O cf-plugin-usb.zip https://github.com/SUSE/cf-usb-plugin/releases/download/0.0.1/cf-plugin-usb-linux-amd64.zip
RUN unzip cf-plugin-usb.zip
RUN mv cf-plugin-usb /out
RUN chmod +x /out/cf /out/cf-plugin-usb

COPY . /go/src/github.com/SUSE/cf-usb-sidecar

WORKDIR /go/src/github.com/SUSE/cf-usb-sidecar

RUN make tools

ENTRYPOINT echo `hostname`
